# Email Threads System - Complete ASCII Architecture & Data Flow

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                                    EMAIL THREADS SYSTEM ARCHITECTURE                                â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                        INPUT SOURCES                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    ğŸ“„ email_test_data.csv       ğŸ“„ *.dat files        ğŸŒ Web Upload       ğŸ“ Custom CSV
           â”‚                           â”‚                     â”‚                    â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                       â”‚                     â”‚
                                       â–¼                     â–¼
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚                         DATA INGESTION LAYER                           â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                                         CLI APPLICATION                                              â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    ğŸš€ index.js (Entry Point)
           â”‚
           â”œâ”€â”€â”€ ğŸ“ require('./src/emailThreadProcessor')
           â”‚              â”‚
           â”‚              â–¼
           â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚    â”‚           EmailThreadProcessor Class                        â”‚
           â”‚    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
           â”‚    â”‚  â”‚  ğŸ“¥ loadEmailsFromFile(csvPath)                    â”‚    â”‚
           â”‚    â”‚  â”‚      â”‚                                             â”‚    â”‚
           â”‚    â”‚  â”‚      â”œâ”€â”€â”€ csv-parser â”€â”€â–º parseColumnHistory()     â”‚    â”‚
           â”‚    â”‚  â”‚      â”‚                        â”‚                   â”‚    â”‚
           â”‚    â”‚  â”‚      â”‚                        â–¼                   â”‚    â”‚
           â”‚    â”‚  â”‚      â”‚              ğŸ§¬ Extract Threading Info:    â”‚    â”‚
           â”‚    â”‚  â”‚      â”‚                 â€¢ messageId               â”‚    â”‚
           â”‚    â”‚  â”‚      â”‚                 â€¢ inReplyTo               â”‚    â”‚
           â”‚    â”‚  â”‚      â”‚                 â€¢ references              â”‚    â”‚
           â”‚    â”‚  â”‚      â”‚                 â€¢ threadId                â”‚    â”‚
           â”‚    â”‚  â”‚      â”‚                 â€¢ isForward               â”‚    â”‚
           â”‚    â”‚  â”‚      â”‚                 â€¢ isExternal              â”‚    â”‚
           â”‚    â”‚  â”‚      â”‚                                             â”‚    â”‚
           â”‚    â”‚  â”‚      â–¼                                             â”‚    â”‚
           â”‚    â”‚  â”‚  ğŸ—‚ï¸ groupByThreads()                              â”‚    â”‚
           â”‚    â”‚  â”‚      â”‚                                             â”‚    â”‚
           â”‚    â”‚  â”‚      â”œâ”€â”€â”€ Sort by date â”€â”€â–º Map<threadId, emails[]>â”‚    â”‚
           â”‚    â”‚  â”‚      â”‚                                             â”‚    â”‚
           â”‚    â”‚  â”‚      â–¼                                             â”‚    â”‚
           â”‚    â”‚  â”‚  ğŸŒ³ buildThreadTree(threadId)                      â”‚    â”‚
           â”‚    â”‚  â”‚      â”‚                                             â”‚    â”‚
           â”‚    â”‚  â”‚      â”œâ”€â”€â”€ Create parent-child relationships      â”‚    â”‚
           â”‚    â”‚  â”‚      â”œâ”€â”€â”€ Build tree structure                   â”‚    â”‚
           â”‚    â”‚  â”‚      â””â”€â”€â”€ Return: { roots, participants, etc }   â”‚    â”‚
           â”‚    â”‚  â”‚                                                   â”‚    â”‚
           â”‚    â”‚  â”‚  ğŸ“Š generateThreadStats(threadId)                 â”‚    â”‚
           â”‚    â”‚  â”‚      â”‚                                             â”‚    â”‚
           â”‚    â”‚  â”‚      â”œâ”€â”€â”€ maxDepth calculation                   â”‚    â”‚
           â”‚    â”‚  â”‚      â”œâ”€â”€â”€ branch counting                        â”‚    â”‚
           â”‚    â”‚  â”‚      â”œâ”€â”€â”€ reply/forward counts                   â”‚    â”‚
           â”‚    â”‚  â”‚      â””â”€â”€â”€ participant analysis                   â”‚    â”‚
           â”‚    â”‚  â”‚                                                   â”‚    â”‚
           â”‚    â”‚  â”‚  ğŸ’¾ exportForPythonProcessing()                   â”‚    â”‚
           â”‚    â”‚  â”‚      â”‚                                             â”‚    â”‚
           â”‚    â”‚  â”‚      â”œâ”€â”€â”€ generateEmlContent() â”€â”€â–º .eml files    â”‚    â”‚
           â”‚    â”‚  â”‚      â””â”€â”€â”€ thread_metadata.json                   â”‚    â”‚
           â”‚    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
           â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”œâ”€â”€â”€ ğŸ–¥ï¸ displayThreadStructure() â”€â”€â–º Console ASCII Art
           â”‚
           â””â”€â”€â”€ ğŸ“„ generateThreadReport() â”€â”€â–º thread_report.json


â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                                          WEB APPLICATION                                            â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    ğŸŒ www/index.html (Entry Point)
           â”‚
           â”œâ”€â”€â”€ ğŸ“¦ www/index.js (EmailThreadApp)
           â”‚         â”‚
           â”‚         â”œâ”€â”€â”€ ğŸ¦€ WASM Integration
           â”‚         â”‚      â”‚
           â”‚         â”‚      â”œâ”€â”€â”€ init() â”€â”€â–º pkg/email_threads_wasm.js
           â”‚         â”‚      â”‚                    â”‚
           â”‚         â”‚      â”‚                    â”œâ”€â”€â”€ Rust lib.rs compiled to WASM
           â”‚         â”‚      â”‚                    â””â”€â”€â”€ EmailThreadProcessor (Rust)
           â”‚         â”‚      â”‚
           â”‚         â”‚      â””â”€â”€â”€ set_panic_hook() â”€â”€â–º Error handling
           â”‚         â”‚
           â”‚         â”œâ”€â”€â”€ ğŸ›ï¸ Event Management
           â”‚         â”‚      â”‚
           â”‚         â”‚      â”œâ”€â”€â”€ File Upload Handler
           â”‚         â”‚      â”œâ”€â”€â”€ View Toggle (Tree/Timeline/Compact)
           â”‚         â”‚      â”œâ”€â”€â”€ Thread Selection
           â”‚         â”‚      â””â”€â”€â”€ Sample Data Loading
           â”‚         â”‚
           â”‚         â”œâ”€â”€â”€ ğŸ“Š Visualization Engine
           â”‚         â”‚      â”‚
           â”‚         â”‚      â”œâ”€â”€â”€ D3.js Integration
           â”‚         â”‚      â”œâ”€â”€â”€ renderThreadTree()
           â”‚         â”‚      â”œâ”€â”€â”€ renderTimeline()
           â”‚         â”‚      â””â”€â”€â”€ renderCompactView()
           â”‚         â”‚
           â”‚         â””â”€â”€â”€ ğŸ¨ UI State Management
           â”‚                â”‚
           â”‚                â”œâ”€â”€â”€ Thread sidebar updates
           â”‚                â”œâ”€â”€â”€ Statistics display
           â”‚                â””â”€â”€â”€ Performance monitoring
           â”‚
           â”œâ”€â”€â”€ ğŸ¨ www/styles.css â”€â”€â–º UI Styling
           â”‚
           â””â”€â”€â”€ âš™ï¸ webpack.config.js â”€â”€â–º Build Configuration

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                                       RUST/WASM CORE                                               â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    ğŸ¦€ src/lib.rs (High-Performance Core)
           â”‚
           â”œâ”€â”€â”€ ğŸ“Š CsvRecord Struct
           â”‚      â”‚
           â”‚      â”œâ”€â”€â”€ Serde deserialization
           â”‚      â”œâ”€â”€â”€ Field mapping
           â”‚      â””â”€â”€â”€ Data validation
           â”‚
           â”œâ”€â”€â”€ ğŸ§µ EmailThreadProcessor Struct
           â”‚      â”‚
           â”‚      â”œâ”€â”€â”€ process_csv_data()
           â”‚      â”‚      â”‚
           â”‚      â”‚      â”œâ”€â”€â”€ Parse CSV records
           â”‚      â”‚      â”œâ”€â”€â”€ Extract thread metadata
           â”‚      â”‚      â””â”€â”€â”€ Return processed data
           â”‚      â”‚
           â”‚      â”œâ”€â”€â”€ build_thread_tree()
           â”‚      â”‚      â”‚
           â”‚      â”‚      â”œâ”€â”€â”€ Parent-child relationship mapping
           â”‚      â”‚      â”œâ”€â”€â”€ Tree structure creation
           â”‚      â”‚      â””â”€â”€â”€ Statistics calculation
           â”‚      â”‚
           â”‚      â””â”€â”€â”€ export_thread_data()
           â”‚             â”‚
           â”‚             â”œâ”€â”€â”€ JSON serialization
           â”‚             â””â”€â”€â”€ WASM-JS bridge
           â”‚
           â””â”€â”€â”€ ğŸŒ‰ WASM Bindings
                  â”‚
                  â”œâ”€â”€â”€ #[wasm_bindgen] annotations
                  â”œâ”€â”€â”€ JavaScript interop
                  â””â”€â”€â”€ Memory management

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                                      DATABASE LAYER                                                â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    ğŸ—„ï¸ src/duckdb/ (Analytics & Storage)
           â”‚
           â”œâ”€â”€â”€ ğŸ“Š EmailThreadDuckDB.js
           â”‚      â”‚
           â”‚      â”œâ”€â”€â”€ Database connection management
           â”‚      â”œâ”€â”€â”€ Table creation & schema
           â”‚      â”œâ”€â”€â”€ Email data insertion
           â”‚      â”œâ”€â”€â”€ Thread query operations
           â”‚      â””â”€â”€â”€ Performance analytics
           â”‚
           â”œâ”€â”€â”€ ğŸ”§ debug_tables.js
           â”‚      â”‚
           â”‚      â”œâ”€â”€â”€ Table inspection utilities
           â”‚      â”œâ”€â”€â”€ Data validation
           â”‚      â””â”€â”€â”€ Debug output formatting
           â”‚
           â””â”€â”€â”€ ğŸ“‹ example_usage.js
                  â”‚
                  â”œâ”€â”€â”€ Usage demonstrations
                  â”œâ”€â”€â”€ Query examples
                  â””â”€â”€â”€ Best practices

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                                    VISUALIZATION LAYER                                             â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    ğŸ¨ src/visualization/threadVisualizer.js
           â”‚
           â”œâ”€â”€â”€ Tree View Rendering
           â”‚      â”‚
           â”‚      â”œâ”€â”€â”€ Hierarchical layout
           â”‚      â”œâ”€â”€â”€ Node positioning
           â”‚      â””â”€â”€â”€ Edge drawing
           â”‚
           â”œâ”€â”€â”€ Timeline View
           â”‚      â”‚
           â”‚      â”œâ”€â”€â”€ Chronological ordering
           â”‚      â”œâ”€â”€â”€ Time axis scaling
           â”‚      â””â”€â”€â”€ Event plotting
           â”‚
           â””â”€â”€â”€ Interactive Features
                  â”‚
                  â”œâ”€â”€â”€ Zoom & pan controls
                  â”œâ”€â”€â”€ Node selection
                  â””â”€â”€â”€ Tooltip displays

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                                     OUTPUT DESTINATIONS                                            â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    ğŸ“ output/ALPHA-2024-001/
           â”‚
           â”œâ”€â”€â”€ ğŸ“§ eml_files/
           â”‚      â”‚
           â”‚      â”œâ”€â”€â”€ BEG_001.eml
           â”‚      â”œâ”€â”€â”€ BEG_002.eml
           â”‚      â””â”€â”€â”€ ... (RFC 5322 format)
           â”‚
           â””â”€â”€â”€ ğŸ“„ thread_metadata.json
                  â”‚
                  â”œâ”€â”€â”€ Thread structure
                  â”œâ”€â”€â”€ Statistics
                  â””â”€â”€â”€ Participant data

    ğŸ“ exports/
           â”‚
           â”œâ”€â”€â”€ ğŸ“Š email_data.json
           â”‚      â”‚
           â”‚      â”œâ”€â”€â”€ Processed email records
           â”‚      â””â”€â”€â”€ Thread relationships
           â”‚
           â””â”€â”€â”€ ğŸ“ˆ email_threads_analysis.csv
                  â”‚
                  â”œâ”€â”€â”€ Statistical summaries
                  â””â”€â”€â”€ Analytics data

    ğŸ“„ thread_report.json
           â”‚
           â”œâ”€â”€â”€ Global summary
           â”œâ”€â”€â”€ Per-thread statistics
           â””â”€â”€â”€ Processing metadata

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                                        DATA FLOW                                                   â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

CSV Input â”€â”€â–º Parse Headers â”€â”€â–º Extract Threading â”€â”€â–º Group by Threads â”€â”€â–º Build Trees â”€â”€â–º Generate Stats
    â”‚              â”‚                    â”‚                    â”‚                 â”‚               â”‚
    â”‚              â–¼                    â–¼                    â–¼                 â–¼               â–¼
    â”‚         Column History     Message Metadata      Thread Groups     Tree Structure   Statistics
    â”‚         Extraction         â€¢ messageId          Map<threadId,     â€¢ roots          â€¢ depth
    â”‚                           â€¢ inReplyTo           emails[]>         â€¢ children       â€¢ branches
    â”‚                           â€¢ references                            â€¢ participants   â€¢ counts
    â”‚                           â€¢ threadId
    â”‚
    â””â”€â–º Export Formats:
        â”œâ”€â”€â”€ ğŸ“§ EML Files (RFC 5322)
        â”œâ”€â”€â”€ ğŸ“„ JSON Reports
        â”œâ”€â”€â”€ ğŸ“Š CSV Analysis
        â””â”€â”€â”€ ğŸŒ Web Visualization

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                                    EXECUTION PATHWAYS                                              â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

CLI Mode (npm start):
   index.js â”€â”€â–º EmailThreadProcessor â”€â”€â–º CSV Parse â”€â”€â–º Thread Analysis â”€â”€â–º Console Output + File Export

Web Mode (cd www && npm start):
   webpack-dev-server â”€â”€â–º index.html â”€â”€â–º index.js â”€â”€â–º WASM â”€â”€â–º Interactive Visualization

Testing Mode (npm test):
   Playwright â”€â”€â–º email-threads.spec.js â”€â”€â–º Automated UI Testing â”€â”€â–º Results Report

Build Mode:
   Rust Source â”€â”€â–º wasm-pack â”€â”€â–º WASM Binary â”€â”€â–º webpack â”€â”€â–º Production Bundle
```

## Key Component Interactions:

1. **CSV Parser** â†’ **Thread Processor** â†’ **Tree Builder** â†’ **Statistics Generator**
2. **WASM Core** â†” **JavaScript App** â†” **D3 Visualization** â†” **DOM Updates**
3. **DuckDB Layer** â†” **Analytics Engine** â†” **Query Interface** â†” **Results Display**
4. **File System** â†” **Export Manager** â†” **Format Converters** â†” **Output Files**

## Performance Optimizations:

- **Rust/WASM**: High-performance CSV parsing and thread analysis
- **Lazy Loading**: Progressive data loading for large datasets
- **Caching**: Thread tree caching for repeated operations
- **Streaming**: CSV streaming for memory efficiency